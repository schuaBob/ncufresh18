<script src="https://cdn.jsdelivr.net/npm/jquery@3.1.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>

<script>
    //載入IFrame Player API code
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    let x, n=0, nx=0, rotINT, rotate = 0, end = 1;
    let currentid = "", currentcollege, currentbtnImg, lastbtnImg, currentbutton, QAvideoplay = 0;//currentid紀錄現在播到哪個影片
    //var allmove, move, moveINT, moveD = 0, i=0, moveend=1;
    //var player;
    //function onYouTubeIframeAPIReady() {player = new YT.Player('playser');}
    //初始影片
    
    //let aaa = JSON.parse(<%= %>);
        let player = Object();
        function onYouTubeIframeAPIReady() {//此函數在IFrame Player API code 載入後將自動呼叫
            $(".player").each(function(){
                //console.log(this.id);
                //console.log($(this));
                let id=this.id;
                player[id] = new YT.Player(id, {
                    height: '390',
                    width: '640',
                    videoId: id, //Youtube ID
                    enablejsapi: 1,
                    origin: 'http://localhost:3000'

                });
            })
        }
    
     
    

    $(document).ready(() => {
        $(document).on("click",".rotate",function(event){//旋轉唱片盒
            if(end == 1){//end記錄唱片盒轉完了沒
                if(rotate == 0){
                    $('.rotate').html('影片');
                    if(currentid != ""){
                        player[currentid].pauseVideo();
                    }
                    //console.log(currentid);
                    //rotate = 1;
                }
                else{
                    $('.rotate').html('簡介');
                    
                    //rotate = 0;
                }
                rotateDIV()
            }
            
        })

        $(document).on("click",".turn",function(event){
            if(rotate==1){//每個按鍵都唱片盒轉回正面
                $('.rotate').html('簡介');
                rotate = 0;
                rotateDIV()
            }
        })

        $('.video_item').mouseenter(function() {
            if($(window).width()>=414){
                // $('.sbtn').parent("td").css("display", "none");
                // $('.sbtn').css("display", "none");
                // $('.video_item_'+$(this).attr("video")).parent("td").css({"display": ""});
                // console.log($('.video_item_'+$(this).attr("video")).css({"display": "block"}));
                
                // if($(this).attr("video") == "longvideo"){
                //     for(let i = 1; i <= 5; i++){
                //         console.log(".video_item_longvideo_"+ i);
                //         console.log((i-1) *100);
                        // $(".video_item_longvideo"+ i ).velocity({
                        //     opacity:100
                        // }, {
                        //     duration: 100,
                        //     delay: (i-1) *100
                        // });
                //     }
                // }
                // else if($(this).attr("video") == "QAvideo"){
                //     for(let i = 1; i <= 8; i++){
                        
                //     }
                // }
                // else if($(this).attr("video") == "lifevideo"){
                //     for(let i = 1; i <= 6; i++){
                        
                //     }
                // }
            }
        })

        $(document).on("click",".video_item",function(event){
            

            $("#CDbox").css('background-image', 'url("background_'+$(this).attr("video")+'.png")');
            
            if($(window).width()<414)
            {
                $(".sbtn").removeClass("btn-outline-item-click");
                $(".sbtn").addClass("btn-outline-item");

                // $(".video_item_title, #scroll").animate({
                //     scrollTop: 100
                // }, 500, function(){
                //     $(".video_item_title, #scroll").animate({
                //         scrollTop: 0
                //     }, 1000)
                // });

                $("#scroll")
                    .velocity("stop")
                    .velocity("scroll", { 
                        container: $("#scrolltable"), 
                        duration: 500, 
                        offset: 50, 
                        complete:function(){
                            $("#scroll").velocity("scroll", { 
                                container: $("#scrolltable"), 
                                duration: 1000, 
                                offset: -50, 
                            });
                        } 
                    });
                
                
                
            }
            else {

            }

            

            if(this.id != "back"){
                QAvideoplay = 0;
                $("iframe").css("display", "none");
                $(".picture").css("display", "none");
                if(currentid)
                    player[currentid].pauseVideo();

                $(".video_item").removeClass("btn-outline-item-click");
                $(".video_item").addClass("btn-outline-title");
                $(this).removeClass("btn-outline-title");
                $(this).addClass("btn-outline-item-click");

                if(lastbtnImg && currentbtnImg && $(window).width()>=414){
                    $(currentbutton).attr("src", lastbtnImg);
                    console.log("if0 "+currentbtnImg + " last:" + lastbtnImg)
                }
                $(".sbtn").removeClass("up");
            }
            //$('.rotate').css("display", "none");
            //console.log($('.sbtn').parent("td"));
            $('.sbtn').parent("td").css("display", "none");
            $('.sbtn').css("display", "none");
            //console.log($('.video_item_'+$(this).attr("video")).parent("td"));
            $('.video_item_'+$(this).attr("video")).parent("td").css({"display": ""});
            $('.video_item_'+$(this).attr("video")).css({"display": "block"});

            // if($(this).attr("video") == "longvideo"){
            //     for(let i = 1; i <= 5; i++){
            //         console.log(".video_item_longvideo_"+ i);
            //         console.log((i-1) *100);
            //         $(".video_item_longvideo"+ i ).velocity({
            //             opacity:1
            //         }, {
            //             duration: 100,
            //             delay: (i-1) *100
            //         });
            //     }
            // }
            
            $(document).on("click",".video_item_"+$(this).attr("video"),function(event){
                if($(window).width()<414)
                {
                    $(".sbtn").removeClass("btn-outline-item-click");
                    $(".sbtn").addClass("btn-outline-item");
                    $(this).removeClass("btn-outline-item");
                    $(this).addClass("btn-outline-item-click");
                }
                
                if($(this).attr("college")!= currentcollege){
                    if(lastbtnImg && currentbtnImg && $(window).width()>=414){
                        $(currentbutton).attr("src", lastbtnImg);
                        console.log("if1 "+currentbtnImg + " last:" + lastbtnImg)
                    }
                    $(".sbtn").removeClass("up");
                }
                
                //console.log(this);
                if($(this).attr("video") == "QAvideo"){
                    // if($(window).width()>=414){
                    //     lastbtnImg = $(this).attr("src");
                    //     $(this).attr("src", currentbtnImg);
                    //     console.log($(this).attr("class") + "if2 "+ currentbtnImg + " last:" + lastbtnImg)
                    // }
                    // $(currentbutton).addClass("up");

                    //console.log('QAvideo!');
                    $('.sbtn').parent("td").css("display", "none");
                    $('.sbtn').css("display", "none");
                    $(".video_item_QAvideo_"+ $(this).attr('college')).parent("td").css("display", "");
                    $(".video_item_QAvideo_"+ $(this).attr('college')).css("display", "block");
                
                    
                    
                    if(QAvideoplay == 1){
                        $('.rotate').css('display', "block");
                    }

                    if((this.id != "back") && (currentcollege != $(this).attr("college"))){
                        //console.log("QAvideoplay = 0");
                        QAvideoplay = 0;
                        $("#CDbox").css('background-image', 'url("background_'+$(this).attr("college")+'.png")');
                        $("iframe").css("display", "none");
                        $(".picture").css("display", "none");
                        if(currentid)
                            player[currentid].pauseVideo();
                    }
                    currentcollege = $(this).attr("college");
                
                    $(document).on("click",".video_item_QAvideo_"+ $(this).attr('college'),function(event){
                        //console.log("QAvideoplay = 1");
                        if($(window).width()<414)
                        {   
                            $(".sbtn").removeClass("btn-outline-item-click");
                            $(".sbtn").addClass("btn-outline-item");
                            $(this).removeClass("btn-outline-item");
                            $(this).addClass("btn-outline-item-click");
                        }

                        if(lastbtnImg && currentbtnImg &&  $(window).width()>=414 && this.id != "back"){
                            $(currentbutton).attr("src", lastbtnImg);
                            console.log("if3 "+ currentbtnImg + " last:" + lastbtnImg)
                        }
                        
                        //console.log($(this).id);
                        $(".sbtn").removeClass("up");
                        if(this.id != "back"){
                            if($(window).width()>=414){
                                lastbtnImg = $(this).attr("src");
                                $(this).velocity({
                                    opacity:0
                                }, {
                                    duration: 500,
                                    complete:function(){
                                        $(this).attr("src", "button/1/起源盒.png");
                                        $(this).addClass("up");
                                        $(this).velocity({
                                            opacity:1
                                        }, {
                                            duration: 300,
                                        });
                                    } 
                                });
                                // $(this).attr("src", "button/1/起源盒.png");
                                currentbtnImg = $(this).attr("src");
                                console.log("if4 "+ currentbtnImg + " last:" + lastbtnImg)
                            }
                            
                            
                            
                            currentbutton = this;
                            //console.log(currentbutton);
                        }
                        

                        QAvideoplay = 1;
                        $("#"+$(this).attr("ytID")).css("display", "block");
                    })
                }
                else{
                    if($(window).width()>=414){
                        lastbtnImg = $(this).attr("src");
                        $(this).velocity({
                            opacity:0
                        }, {
                            duration: 500,
                            complete:function(){
                                $(this).attr("src", "button/1/起源盒.png");
                                $(this).addClass("up");
                                $(this).velocity({
                                    opacity:1
                                }, {
                                    duration: 300,
                                });
                            } 
                        });
                        // $(this).attr("src", "button/1/起源盒.png");
                        currentbtnImg = $(this).attr("src");
                        console.log("if5 "+ currentbtnImg + " last:" + lastbtnImg)
                    }


                    //$(this).addClass("up");
                    currentbutton = this;
                    currentcollege = "";

                    $("#"+$(this).attr("ytID")).css("display", "block");
                }
                    
            })
            
            
        })


        $(document).on("click",".ssbtn",function(event){
            // console.log(currentid);
            // console.log(player[currentid]);
            if(currentid != ""){
                player[currentid].pauseVideo();
            }
            currentid = $(this).attr('ytID');
            $('.rotate').css('display', "block");
            $("iframe").css("display", "none");
            $("#"+ $(this).attr('ytID')).css("display", "block");
            $(".picture").css("display", "none");
            $("."+ $(this).attr('ytID')).css("display", "block");
                
        })

        $(document).on("click","#back",function(event){
            //console.log("if QAvideoplay?");
            //console.log(QAvideoplay);
            if(QAvideoplay == 1)
                $('.rotate').css('display', "block");
                
        })


        
    })


    $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').trigger('focus')
    })
        
    
    function rotateDIV()
    {
        x=document.getElementById("CDbox")
        
        clearInterval(rotINT)
        rotINT=setInterval("startRotate()",10)
    }

    function startRotate()
    {
        end = 0;
        nx=nx+2.5
        x.style.transform="rotateX(" + nx + "deg)"
        x.style.webkitTransform="rotateX(" + nx + "deg)"
        x.style.OTransform="rotateX(" + nx + "deg)"
        x.style.MozTransform="rotateX(" + nx + "deg)"
        if(nx == 90){
            $('.CDplayer').css("display", "none");
            $('.CDpicture').css("display", "block");
            
        }
        else if(nx == 270){
            $('.CDplayer').css("display", "block");
            $('.CDpicture').css("display", "none");
            
        }
        if (nx==180 || nx>=360)
        {
            rotate = 1;
            clearInterval(rotINT)
            if (nx>=360){
                nx=0
                rotate = 0;
            }
            end = 1;
        }
    }

    

    // function startMove()
    // {
    //     moveD=moveD+1
    //     move.style.transform="translateX(" + moveD + "vw)"
    //     move.style.webkitTransform="translateX(" + moveD + "vw)"
    //     move.style.OTransform="translateX(" + moveD + "vw)"
    //     move.style.MozTransform="translateX(" + moveD + "vw)"
        
    //     if (moveD == (4-i)*20)
    //     {
    //         console.log(moveD);
    //         clearInterval(moveINT)
    //         moveD = 0;
    //         moveend = 1;
    //         i++;
    //     }
    // }

    

    

    
       
</script>
