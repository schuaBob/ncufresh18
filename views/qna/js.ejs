<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src='https://www.google.com/recaptcha/api.js'></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
<script>
$(document).ready(() => {
    if ($(window).width() < 800) {
        //手機版頁面樣式
        var h=$(window).height()-30;
        //搜尋的位置
        $(".search").css({"float":"left"});
        // $(".classifiaction").css({"float":"left"});
        //排序與分類的位置
        $(".classification").addClass("dropdown-menu");
        $("ul").addClass("flex-column");
        //$(".computer").hide();
        //筆記本框框消失吧
        $(".outOfTable").hide();
        //管理員相關的功能隱藏起來
        $(".admin").hide();
        //文章列表樣式
        $('table').css({"width":$(window).width()});
        //$('tbody').css({"height":$(window).height()-30});
        //modal的樣式
        // $(".modal").css({"height":$(window).height()});
        //我要發問按鈕的位置
        $(".askbutton").hide();//隱藏電腦版的我要發問按鈕
    }
    else{
        //電腦版頁面樣式
        //我要發問按鈕的位置
        $(".askbutton2").hide();//隱藏手機版的我要發問按鈕
        //搜尋的位置
        $(".search").css({"float":"right"});
        //文章列表樣式
        $('table').css({"width":"70%"});
        //$('tbody').css({"height":"300px"});
        $('td').css({"border-right":"1.5px black solid"});
        //排序跟分類的按鈕
        $(".classificationBtn").hide();
        //排序與分類的位置
        //$(".cellphone").hide();
        
    }
    //預設分類
    if ($(window).width() < 800) {
        $("li a[href='#all']").css({"color":"#29ABE2","font-weight":"bold"});
        $("li a[href='/qna/time']").css({"color":"#29ABE2","font-weight":"bold"});
    }
    else{
        $("li a[href='#all']").css({"background-color":"#29ABE2","border-radius":"20px"});
        $("li a[href='/qna/time']").css({"background-color":"#29ABE2","border-radius":"20px"});
    }
    //只看單一分類
    $("li a[href='#school'], li a[href='#student'], li a[href='#class'], li a[href='#others'], li a[href='#all']").on('click', function(event) {
        event.preventDefault();
        // Store hash
        var hash = this.hash;
        if(hash==="#all"){
            if ($(window).width() < 800) {
            $("li a[href='#all']").css({"color":"#29ABE2","font-weight":"bold"});
            $("li a[href='#student']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#class']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#others']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#school']").css({"color":"black","font-weight":"normal"});
        }
        else{
            $("li a[href='#all']").css({"background-color":"#29ABE2","border-radius":"20px"});
            $("li a[href='#student']").css({"background-color":"transparent"});
            $("li a[href='#class']").css({"background-color":"transparent"});
            $("li a[href='#others']").css({"background-color":"transparent"});
            $("li a[href='#school']").css({"background-color":"transparent"});
        }
        $('tr.Q').fadeIn(500);
        }
        else if(hash==="#school"){
            if ($(window).width() < 800) {
            $("li a[href='#school']").css({"color":"#29ABE2","font-weight":"bold"});
            $("li a[href='#student']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#class']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#others']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#all']").css({"color":"black","font-weight":"normal"});
        }
        else{
            $("li a[href='#school']").css({"background-color":"#29ABE2","border-radius":"20px"});
            $("li a[href='#student']").css({"background-color":"transparent"});
            $("li a[href='#class']").css({"background-color":"transparent"});
            $("li a[href='#others']").css({"background-color":"transparent"});
            $("li a[href='#all']").css({"background-color":"transparent"});
        }
        $('tr.Q').hide();
        $('tr.校園生活').fadeIn(500);
        }
        else if(hash==="#student"){
            if ($(window).width() < 800) {
            //手機版樣式
            $("li a[href='#student']").css({"color":"#29ABE2","font-weight":"bold"});
            $("li a[href='#school']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#class']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#others']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#all']").css({"color":"black","font-weight":"normal"});
        }
        else{
            //電腦版樣式
            $("li a[href='#student']").css({"background-color":"#29ABE2","border-radius":"20px"});
            $("li a[href='#school']").css({"background-color":"transparent"});
            $("li a[href='#class']").css({"background-color":"transparent"});
            $("li a[href='#others']").css({"background-color":"transparent"});
            $("li a[href='#all']").css({"background-color":"transparent"});
        }
        $('tr.Q').hide();
        $('tr.學生事務').fadeIn(500);
        }
        else if(hash==="#class"){
            if ($(window).width() < 800) {
            $("li a[href='#class']").css({"color":"black","font-weight":"bold"});
            $("li a[href='#student']").css({"color":"#29ABE2","font-weight":"normal"});
            $("li a[href='#school']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#others']").css({"color":"black","font-weight":"normal"});
            $("li a[href='#all']").css({"color":"black","font-weight":"normal"});
        }
        else{
            $("li a[href='#class']").css({"background-color":"#29ABE2","border-radius":"20px"});
            $("li a[href='#student']").css({"background-color":"transparent"});
            $("li a[href='#school']").css({"background-color":"transparent"});
            $("li a[href='#others']").css({"background-color":"transparent"});
            $("li a[href='#all']").css({"background-color":"transparent"});
        }
        $('tr.Q').hide();
        $('tr.課程相關').fadeIn(500);
        }
        else if(hash==="#others"){
            if ($(window).width() < 800) {
                $("li a[href='#others']").css({"color":"#29ABE2","font-weight":"bold"});
                $("li a[href='#student']").css({"color":"black","font-weight":"normal"});
                $("li a[href='#class']").css({"color":"black","font-weight":"normal"});
                $("li a[href='#school']").css({"color":"black","font-weight":"normal"});
                $("li a[href='#all']").css({"color":"black","font-weight":"normal"});
            }
            else{
                $("li a[href='#others']").css({"background-color":"#29ABE2","border-radius":"20px"});
                $("li a[href='#student']").css({"background-color":"transparent"});
                $("li a[href='#class']").css({"background-color":"transparent"});
                $("li a[href='#school']").css({"background-color":"transparent"});
                $("li a[href='#all']").css({"background-color":"transparent"});
            }
            $('tr.Q').hide();
            $('tr.其他').fadeIn(500);
        }      
    });
    //排序判別
    var url = new URL(window.location.href);
    if(url.pathname==="/qna/hot"){
        if ($(window).width() < 800) {
            //手機版排序按鈕動畫
            $("li a[href='/qna/hot']").css({"color":"#29ABE2","font-weight":"bold"});
            $("li a[href='/qna/time']").css({"color":"black","font-weight":"normal"});
        }
        else{
            //電腦版排序按鈕動畫
            $("li a[href='/qna/hot']").css({"background-color":"#29ABE2","border-radius":"20px"});
            $("li a[href='/qna/time']").css({"background-color":"transparent"});
        }
        
    }
    else if(url.pathname==="/qna/time"){
        if ($(window).width() < 800) {
            //手機版排序按鈕動畫
            $("li a[href='/qna/time']").css({"color":"#29ABE2","font-weight":"bold"});
            $("li a[href='/qna/hot']").css({"color":"black","font-weight":"normal"});
        }
        else{
            //電腦版排序按鈕動畫
            $("li a[href='/qna/time']").css({"background-color":"#29ABE2","border-radius":"20px"});
            $("li a[href='/qna/hot']").css({"background-color":"transparent"});
        }
    }
    //人氣與時間排序
    $("li a[href='/qna/hot']").on("click",function(){
        $.ajax({
            url:    "/qna/hot",
            method:'GET',
        }).done(function(res) {
            console.log("測試用");
        });
    });
    //紀錄問題點擊次數
    $(".titleQ").on('click',function(){
        //var id = $(this).prop('id');
        var id = this.id.split('-')[0];
        $.ajax({
            url: '/qna/clickQ/' + id,
            method: 'GET',
            success: function(res) {
            
                //動態新增點擊次數
                var objs = $('.' + id).find('.view');
                for (var i = 0; i < objs.length; i++) {
                    objs[i].innerHTML = parseInt(objs[i].innerHTML) + 1;
                }
        
            }
        })
    })
    //紀錄板規點擊次數
    $(".titleR").on('click',function(){
        //var id = $(this).prop('id');
        var id = this.id.split('-')[0];
        $.ajax({
            url: '/qna/clickR/' + id,
            method: 'GET',
            success: function(res) {
            
                //動態新增點擊次數
                var objs = $('.' + id).find('.view');
                for (var i = 0; i < objs.length; i++) {
                    objs[i].innerHTML = parseInt(objs[i].innerHTML) + 1;
                }
        
            }
        })
    })
    //CKEDITOR
    CKEDITOR.config.enterMode = CKEDITOR.ENTER_BR;
    CKEDITOR.config.shiftEnterMode = CKEDITOR.ENTER_BR; 
    $('.answer').each(function(e){
        CKEDITOR.replace(this.id,{
        filebrowserUploadUrl: '/uploader',
        });
    });
    //刪除問題
    $('.deleteQ').on('click', function() {
      if (confirm("確定要刪除嗎？")) {
        $.ajax({
          method: 'GET',
          url: '/qna/deleteQ/' + this.id
        }).done(function(res) {
          alert('刪除成功');
          //$('#modal-admin-answer').modal('hide');
          //動態刪除
          $('.' + res.id).remove();
        })
        // .fail(function(err) {
        //   alert('發生錯誤: ' + err);
        // })
      }
    });
    //刪除板規
    $('.deleteR').on('click', function() {
      if (confirm("確定要刪除嗎？")) {
        $.ajax({
          method: 'GET',
          url: '/qna/deleteR/' + this.id
        }).done(function(res) {
          alert('刪除成功');
          //$('#modal-admin-answer').modal('hide');
          //動態刪除
          $('.' + res.id).remove();
        })
        // .fail(function(err) {
        //   alert('發生錯誤: ' + err);
        // })
      }
    });
  
})         
</script>
<script>
    //人氣跟時間的排序(list.js)
    var options = {
        valueNames: [ 'time', 'hot' ]
    };
    var userList = new List('select111', options);
    //預設排序是時間
    userList.sort("time",{
        order:'desc'
        // sortFunction: function (a, b) {
        //     var top=$("td.topT");
            
        // //     if ((a.time === top) != (b.time === top)) {
        // //         return a.time === top ? 1 : -1;
        // //     }
        // //     return a.time > b.time ? 1 : 0;
        // //            //a.time < b.time ? -1 : 0;
        //     if (a.time === b.time) {
        //         // a and b are considered equal, the order is okay
        //         return 0;   
        //     }

        //     if (a.time === top) {
        //         // "NEW" is considered larger than every other value, the order is wrong
        //         return 1;
        //     }

        //     // Correct order if b equals "NEW", otherwise lexicographical comparison
        //     return b.time === top ? -1 : (a.time > b.time ? 1 : -1);

        //  }
    });
    userList.sort("hot",{
        order:'desc',
        // sortFunction: function (a, b) {
            // var top= $("td.topH").val();
            // console.log(top);
            // console.log($(a).find('.view'));
            // if (($(a).find('.view')=== top) != ($(b).find('.view')=== top)) {
                
            //     return $(a).find('.view') === top ? 1 : -1;
            // }
            // return a.hot > b.hot ? 1 : 
            //        a.hot < b.hot ? -1 : 0;

        //     var id = $(this).prop('id');
        //     var view=$('.' + id).find('.view');
        //     console.log(view);
        //     if (a.view === top) {
        //         // a and b are considered equal, the order is okay
        //         return 1;   
        //     }

        //     else if (b.view === top) {
        //         // "NEW" is considered larger than every other value, the order is wrong
        //         return -1;
        //     }

        //     // Correct order if b equals "NEW", otherwise lexicographical comparison
        //     return a.view-b.view;

        //}
    });
</script>